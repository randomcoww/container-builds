FROM docker.io/golang:1.25.1-alpine as build
ARG VERSION

WORKDIR /go/src
RUN set -x \
  \
  && apk add --no-cache \
    git \
    make \
    bash \
    rsync \
  \
  && git clone --depth 1 -b $VERSION https://github.com/kubernetes/kubernetes.git \
  && cd kubernetes \
  && make \
    kube-apiserver \
    kube-controller-manager \
    kube-scheduler

FROM scratch

COPY --from=build /go/src/kubernetes/_output/bin/kube-apiserver /usr/local/bin/
COPY --from=build /go/src/kubernetes/_output/bin/kube-controller-manager /usr/local/bin/
COPY --from=build /go/src/kubernetes/_output/bin/kube-scheduler /usr/local/bin/